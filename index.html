<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تطبيق الأذكار</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        golden: {
                            light: '#e0c97f',
                            DEFAULT: '#a67c2e',
                            dark: '#7c5c1e'
                        },
                        cream: '#fffbe6',
                        darkbg: '#23201a'
                    },
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                        'amiri': ['Amiri', 'serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Amiri:wght@400;700&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f5f5f5;
        }
        
        .dark body {
            background-color: #1a202c;
        }
        
        .prayer-active {
            background-color: #e0c97f;
            color: #7c5c1e;
            transform: scale(1.05);
        }
        
        .dark .prayer-active {
            background-color: #a67c2e;
            color: #fffbe6;
        }
        
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #e0c97f;
            animation: confetti 3s ease-out forwards;
        }
        
        /* Ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Focus states */
        button:focus, input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(224, 201, 127, 0.5);
        }
        
        .dark button:focus, .dark input:focus, .dark select:focus {
            box-shadow: 0 0 0 3px rgba(166, 124, 46, 0.5);
        }
        
        /* Tap targets */
        button, .prayer-time {
            min-height: 48px;
            min-width: 48px;
        }
        
        /* Loading animation */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .skeleton-loading {
            background: linear-gradient(90deg, 
                rgba(224, 201, 127, 0.1) 25%, 
                rgba(224, 201, 127, 0.2) 37%, 
                rgba(224, 201, 127, 0.1) 63%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .dark .skeleton-loading {
            background: linear-gradient(90deg, 
                rgba(166, 124, 46, 0.1) 25%, 
                rgba(166, 124, 46, 0.2) 37%, 
                rgba(166, 124, 46, 0.1) 63%
            );
            background-size: 200% 100%;
        }
    </style>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body class="min-h-screen bg-cream dark:bg-darkbg transition-all duration-300">
    <!-- Header -->
    <header class="bg-golden-light dark:bg-golden-dark text-darkbg dark:text-cream shadow-lg transition-all duration-300 sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-mosque text-2xl"></i>
                    <h1 class="text-xl md:text-2xl font-bold">تطبيق الأذكار</h1>
                </div>
                <div class="flex items-center gap-4">
                    <div class="darkmode-toggle-container">
                        <button id="darkmode-toggle" aria-label="تبديل الوضع الليلي" class="darkmode-toggle">
                            <span id="darkmode-emoji-sun" class="darkmode-emoji sun">☀️</span>
                            <span id="darkmode-emoji-moon" class="darkmode-emoji moon">🌙</span>
                            <span id="darkmode-knob" class="darkmode-knob"></span>
                        </button>
                    </div>
                    <button id="profile-slider-btn" aria-label="القائمة الشخصية" class="p-2 rounded-full hover:bg-golden/20 dark:hover:bg-cream/20 transition-all duration-300">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <div id="profile-sidebar-container"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Prayer Times Section -->
        <section class="mb-8">
            <h2 class="text-xl md:text-2xl font-bold mb-4 text-golden dark:text-golden-light border-b-2 border-golden pb-2 inline-block">
                مواقيت الصلاة واتجاه القبلة
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Prayer Times Card -->
                <div class="bg-white/90 dark:bg-darkbg/90 rounded-xl border-2 border-golden-light dark:border-golden p-4 transition-all duration-300">
                    <div id="prayer-times-container">
                        <div id="next-prayer-countdown" class="text-center py-2 bg-golden/10 dark:bg-golden-dark/20 rounded-lg mb-4 text-golden-dark dark:text-golden-light"></div>
                        <ul id="prayer-times-list" class="space-y-3">
                            <li class="skeleton-loading h-16 rounded-lg"></li>
                            <li class="skeleton-loading h-16 rounded-lg"></li>
                            <li class="skeleton-loading h-16 rounded-lg"></li>
                            <li class="skeleton-loading h-16 rounded-lg"></li>
                            <li class="skeleton-loading h-16 rounded-lg"></li>
                        </ul>
                    </div>
                </div>
                <!-- Qibla Compass Card -->
                <div class="bg-white/90 dark:bg-darkbg/90 rounded-xl border-2 border-golden-light dark:border-golden p-4 text-center transition-all duration-300">
                    <div class="flex flex-col items-center justify-center h-full">
                        <div id="qibla-compass" class="qibla-compass mx-auto mb-4">
                            <div id="qibla-arrow" class="qibla-arrow"></div>
                            <div id="qibla-center" class="qibla-center"></div>
                            <span class="qibla-label qibla-n">N</span>
                            <span class="qibla-label qibla-s">S</span>
                            <span class="qibla-label qibla-w">W</span>
                            <span class="qibla-label qibla-e">E</span>
                        </div>
                        <p class="text-golden-dark dark:text-golden-light text-lg mb-2">اتجاه القبلة</p>
                        <div id="qibla-bearing-display" class="text-xl font-bold text-golden-dark dark:text-golden-light mb-3">--°</div>
                        <button id="qibla-start" class="bg-golden-light hover:bg-golden text-white dark:bg-golden dark:hover:bg-golden-dark px-4 py-2 rounded-lg transition-all duration-300">
                            تفعيل البوصلة
                        </button>
                        <button id="manual-location" class="mt-2 text-sm text-golden-dark dark:text-golden-light underline">
                            تعيين الموقع يدويًا
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tasbeeh Counter Header -->
        <h2 class="text-xl md:text-2xl font-bold mb-4 text-golden dark:text-golden-light border-b-2 border-golden pb-2 inline-block">
            عداد التسبيح
        </h2>
        <!-- Tasbeeh Counter Section -->
        <section class="bg-cream/90 dark:bg-darkbg/90 rounded-2xl border-2 border-golden-light dark:border-golden p-4 md:p-6 mb-8 transition-all duration-300">
            <div class="space-y-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-center gap-4 md:gap-6">
                    <div class="flex flex-col items-center gap-2 w-full md:w-1/2">
                        <label for="tasbeeh-type-select" class="text-golden-dark dark:text-golden-light">نوع الذكر:</label>
                        <select id="tasbeeh-type-select" class="w-full bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden rounded-lg px-4 py-2 text-golden-dark dark:text-golden-light focus:outline-none focus:ring-2 focus:ring-golden transition-all duration-300">
                            <option value="سبحان الله">سبحان الله</option>
                            <option value="الحمد لله">الحمد لله</option>
                            <option value="الله أكبر">الله أكبر</option>
                            <option value="لا إله إلا الله">لا إله إلا الله</option>
                        </select>
                    </div>
                    <div class="flex flex-col items-center gap-2 w-full md:w-1/2">
                        <label for="target-select" class="text-golden-dark dark:text-golden-light">العدد المطلوب:</label>
                        <select id="target-select" class="w-full bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden rounded-lg px-4 py-2 text-golden-dark dark:text-golden-light focus:outline-none focus:ring-2 focus:ring-golden transition-all duration-300">
                            <option value="33">33</option>
                            <option value="100">100</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                            <option value="custom">مخصص</option>
                            <option value="unlimited">غير محدود</option>
                        </select>
                    </div>
                </div>
                <div id="custom-target-container" class="flex flex-col items-center gap-2" style="display: none;">
                    <label for="custom-target" class="text-golden-dark dark:text-golden-light">أدخل العدد المطلوب:</label>
                    <input type="number" id="custom-target" min="1" class="w-32 text-center bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden rounded-lg px-4 py-2 text-golden-dark dark:text-golden-light focus:outline-none focus:ring-2 focus:ring-golden transition-all duration-300">
                </div>
                <div class="flex flex-col items-center gap-4">
                    <div class="relative flex flex-col items-center justify-center">
                        <svg class="progress-ring drop-shadow-lg" width="180" height="180">
                            <circle
                                class="progress-ring__bg"
                                stroke="#e0c97f33"
                                stroke-width="16"
                                fill="#fffbe6"
                                r="75"
                                cx="90"
                                cy="90"
                            />
                            <circle
                                class="progress-ring__circle"
                                stroke="#a67c2e"
                                stroke-width="16"
                                fill="transparent"
                                r="75"
                                cx="90"
                                cy="90"
                                style="stroke-dasharray:471.238, 471.238; stroke-dashoffset:471.238; transition: stroke-dashoffset 0.3s; filter: drop-shadow(0 2px 8px #e0c97f55);"
                            />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center select-none cursor-pointer" id="progress-circle-click">
                            <div id="counter-display" class="text-5xl md:text-6xl font-bold text-golden dark:text-golden-light transition-all duration-300">0</div>
                            <div id="progress-percentage" class="text-golden-dark dark:text-golden-light text-lg mt-1"></div>
                        </div>
                    </div>
                    <button id="reset-btn" class="bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden text-golden-dark dark:text-golden-light px-6 py-2 md:px-8 md:py-3 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 text-lg">
                        إعادة
                    </button>
                </div>
            </div>
        </section>

        <!-- Morning & Evening Adhkar Section -->
        <section class="bg-cream/90 dark:bg-darkbg/90 rounded-2xl border-2 border-golden-light dark:border-golden p-4 md:p-6 mb-8 transition-all duration-300">
            <div class="flex justify-between items-center mb-4">
                <h2 id="adhkar-dynamic-title" class="text-xl md:text-2xl font-bold text-golden dark:text-golden-light border-b-2 border-golden pb-2 inline-block font-tajawal">
                    أذكار الصباح والمساء
                </h2>
                <button id="adhkar-audio-toggle" class="bg-golden-light hover:bg-golden text-white dark:bg-golden dark:hover:bg-golden-dark p-2 rounded-full transition-all duration-300">
                    <i class="fas fa-volume-up"></i>
                </button>
            </div>
            <div id="adhkar-dynamic-list" class="space-y-4 text-golden-dark dark:text-golden-light">
                <!-- Dynamic adhkar will be populated by script -->
                <div class="skeleton-loading h-24 rounded-lg"></div>
            </div>
        </section>

        <!-- After Prayer Adhkar Section -->
        <section class="bg-cream/90 dark:bg-darkbg/90 rounded-2xl border-2 border-golden-light dark:border-golden p-4 md:p-6 transition-all duration-300">
            <h2 class="text-xl md:text-2xl font-bold mb-4 text-golden dark:text-golden-light border-b-2 border-golden pb-2 inline-block font-tajawal">
                أذكار بعد الصلاة
            </h2>
            <div id="after-prayer-list" class="space-y-4 text-golden-dark dark:text-golden-light">
                <!-- After prayer adhkar will be populated by script -->
                <div class="skeleton-loading h-24 rounded-lg"></div>
                <div class="skeleton-loading h-24 rounded-lg"></div>
                <div class="skeleton-loading h-24 rounded-lg"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-golden-light/20 dark:bg-golden-dark/20 text-golden-dark dark:text-golden-light py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0 text-center md:text-right">
                    <h3 class="text-xl font-bold mb-1">تطبيق الأذكار</h3>
                    <p class="text-golden dark:text-golden-light/80 text-sm">تطبيق متكامل للأذكار وأوقات الصلاة</p>
                    <div class="hijri-date text-sm mt-1">
                      التاريخ الهجري: <span id="hijri-date-display">--/--/----</span>
                    </div>
                </div>
                <div class="flex gap-4 mb-4 md:mb-0">
                    <a href="#" aria-label="Facebook" class="text-golden hover:text-golden-dark dark:text-golden-light dark:hover:text-golden transition-colors">
                        <i class="fab fa-facebook-f text-lg"></i>
                    </a>
                    <a href="#" aria-label="Twitter" class="text-golden hover:text-golden-dark dark:text-golden-light dark:hover:text-golden transition-colors">
                        <i class="fab fa-twitter text-lg"></i>
                    </a>
                    <a href="#" aria-label="Instagram" class="text-golden hover:text-golden-dark dark:text-golden-light dark:hover:text-golden transition-colors">
                        <i class="fab fa-instagram text-lg"></i>
                    </a>
                </div>
            </div>
            <div class="border-t border-golden/20 dark:border-golden-light/20 mt-4 pt-4 text-center text-sm">
                <p>© 2025 تطبيق الأذكار. جميع الحقوق محفوظة</p>
            </div>
        </div>
    </footer>

    <!-- Location Modal -->
    <div id="location-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-darkbg rounded-xl w-full max-w-md p-6">
            <h3 class="text-xl font-bold mb-4 text-golden-dark dark:text-golden-light">تعيين الموقع</h3>
            <div class="mb-4">
                <label class="block text-golden-dark dark:text-golden-light text-sm mb-2">خط العرض</label>
                <input type="text" id="manual-lat" class="w-full bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden text-golden-dark dark:text-golden-light p-2 rounded-lg">
            </div>
            <div class="mb-4">
                <label class="block text-golden-dark dark:text-golden-light text-sm mb-2">خط الطول</label>
                <input type="text" id="manual-lon" class="w-full bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden text-golden-dark dark:text-golden-light p-2 rounded-lg">
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancel-location" class="bg-white dark:bg-darkbg border-2 border-golden-light dark:border-golden text-golden-dark dark:text-golden-light px-4 py-2 rounded-lg">
                    إلغاء
                </button>
                <button id="save-location" class="bg-golden-light hover:bg-golden text-white dark:bg-golden dark:hover:bg-golden-dark px-4 py-2 rounded-lg">
                    حفظ
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/profiles.js"></script>
    <script src="js/tasbeeh-inline.js"></script>
    <script src="js/common.js"></script>
    <script src="js/adhkar-dynamic.js"></script>
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    }).catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
        
        // Hijri Date Display
        function updateHijriDate() {
            const today = new Date();
            const hijri = new Intl.DateTimeFormat('ar-TN-u-ca-islamic', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }).format(today);
            
            document.getElementById('hijri-date').textContent = hijri;
            document.getElementById('hijri-date-display').textContent = hijri;
        }
        
        document.addEventListener('DOMContentLoaded', updateHijriDate);
    </script>
</body>
</html>